<section class="py-4" aria-labelledby="hiragana-heading">
    <div class="container">
        <header class="text-center mb-5">
            <h1 id="hiragana-heading" style="font-family:'Playfair Display',serif;font-size:2.2rem;font-weight:700;color:#1a2233;">Học Hiragana</h1>
            <p class="lead" style="font-family:'Inter',sans-serif;color:#444;max-width:600px;margin:16px auto 0;">Học bảng chữ cái Hiragana cơ bản và nâng cao</p>
        </header>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card shadow-sm border-0 fade-in" style="border-radius:20px;">
                    <div class="card-header bg-white border-0" style="border-radius:20px 20px 0 0;">
                        <h3 class="card-title mb-0" style="font-family:'Playfair Display',serif;font-size:1.25rem;">Hiragana Cơ bản</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <% const rows=[['あ', 'い' , 'う' , 'え' , 'お' ],['か', 'き' , 'く' , 'け' , 'こ' ],['さ', 'し' , 'す' , 'せ' , 'そ' ],['た', 'ち' , 'つ' , 'て' , 'と' ],['な', 'に' , 'ぬ' , 'ね' , 'の' ],['は', 'ひ' , 'ふ' , 'へ' , 'ほ' ],['ま', 'み' , 'む' , 'め' , 'も' ],['や', '' , 'ゆ' , '' , 'よ' ],['ら', 'り' , 'る' , 'れ' , 'ろ' ],['わ', '' , '' , '' , 'を' ],['ん', '' , '' , '' , '' ]]; rows.forEach(function(row) { %>
                                <div class="row g-1 mb-1">
                                    <% row.forEach(function(char) { if (char) { const charData=data.basic.find(c=> c.char === char); if (charData) { %>
                                        <div class="col">
                                            <div class="card border-0 shadow-sm" style="border-radius:12px;">
                                                <div class="card-body p-1 text-center">
                                                    <div class="h3 mb-0" style="font-family:'Playfair Display',serif;">
                                                        <%= charData.char %>
                                                    </div>
                                                    <div class="text-muted small">
                                                        <%= charData.romaji %>
                                                    </div>
                                                    <button class="btn btn-writing mt-1" onclick="showWriting('<%= charData.char %>')">Cách Viết</button>
                                                </div>
                                            </div>
                                        </div>
                                        <% } else { %>
                                            <div class="col"></div>
                                            <% } } else { %>
                                                <div class="col"></div>
                                                <% } %>
                                                    <% }); %>
                                </div>
                                <% }); %>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm border-0 fade-in" style="border-radius:20px;">
                    <div class="card-header bg-white border-0" style="border-radius:20px 20px 0 0;">
                        <h3 class="card-title mb-0" style="font-family:'Playfair Display',serif;font-size:1.25rem;">Hiragana với Tenten</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <% const tentenRows=[['が', 'ぎ' , 'ぐ' , 'げ' , 'ご' ],['ざ', 'じ' , 'ず' , 'ぜ' , 'ぞ' ],['だ', 'ぢ' , 'づ' , 'で' , 'ど' ],['ば', 'び' , 'ぶ' , 'べ' , 'ぼ' ],['ぱ', 'ぴ' , 'ぷ' , 'ぺ' , 'ぽ' ]]; tentenRows.forEach(function(row) { %>
                                <div class="row g-1 mb-1">
                                    <% row.forEach(function(char) { const charData=data.tenten.find(c=> c.char === char); if (charData) { %>
                                        <div class="col">
                                            <div class="card border-0 shadow-sm" style="border-radius:12px;">
                                                <div class="card-body p-1 text-center">
                                                    <div class="h3 mb-0" style="font-family:'Playfair Display',serif;">
                                                        <%= charData.char %>
                                                    </div>
                                                    <div class="text-muted small">
                                                        <%= charData.romaji %>
                                                    </div>
                                                    <button class="btn btn-writing mt-1" onclick="showWriting('<%= charData.char %>')">Cách Viết</button>
                                                </div>
                                            </div>
                                        </div>
                                        <% } }); %>
                                </div>
                                <% }); %>
                        </div>
                    </div>
                </div>
                <div class="card shadow-sm border-0 fade-in mt-4" style="border-radius:20px;">
                    <div class="card-header bg-white border-0" style="border-radius:20px 20px 0 0;">
                        <h3 class="card-title mb-0" style="font-family:'Playfair Display',serif;font-size:1.25rem;">Hiragana với Maru</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <% data.maru.forEach(function(char) { %>
                                <div class="col">
                                    <div class="card border-0 shadow-sm" style="border-radius:12px;">
                                        <div class="card-body p-1 text-center">
                                            <div class="h3 mb-0" style="font-family:'Playfair Display',serif;">
                                                <%= char.char %>
                                            </div>
                                            <div class="text-muted small">
                                                <%= char.romaji %>
                                            </div>
                                            <button class="btn btn-writing mt-1" onclick="showWriting('<%= char.char %>')">Cách Viết</button>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal hiển thị cách viết -->
<div class="modal modal-blur fade" id="writingModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cách viết chữ <span id="charDisplay"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <img id="writingImage" src="" alt="Hướng dẫn cách viết chữ Hiragana" class="img-fluid" loading="lazy">
                    </div>
                    <div class="col-md-6">
                        <video id="writingVideo" autoplay loop muted class="w-100" style="aspect-ratio: 1/1; object-fit: cover;" aria-label="Video hướng dẫn viết chữ Hiragana">
                            <source src="" type="video/webm">
                            Trình duyệt của bạn không hỗ trợ video.
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Hàm chuyển đổi ký tự tiếng Nhật sang romaji
    function getRomaji(char) {
        const hiraganaMap = {
            'あ': 'a', 'い': 'i', 'う': 'u', 'え': 'e', 'お': 'o',
            'か': 'ka', 'き': 'ki', 'く': 'ku', 'け': 'ke', 'こ': 'ko',
            'さ': 'sa', 'し': 'shi', 'す': 'su', 'せ': 'se', 'そ': 'so',
            'た': 'ta', 'ち': 'chi', 'つ': 'tsu', 'て': 'te', 'と': 'to',
            'な': 'na', 'に': 'ni', 'ぬ': 'nu', 'ね': 'ne', 'の': 'no',
            'は': 'ha', 'ひ': 'hi', 'ふ': 'fu', 'へ': 'he', 'ほ': 'ho',
            'ま': 'ma', 'み': 'mi', 'む': 'mu', 'め': 'me', 'も': 'mo',
            'や': 'ya', 'ゆ': 'yu', 'よ': 'yo',
            'ら': 'ra', 'り': 'ri', 'る': 'ru', 'れ': 're', 'ろ': 'ro',
            'わ': 'wa', 'を': 'wo', 'ん': 'n',
            'が': 'ga', 'ぎ': 'gi', 'ぐ': 'gu', 'げ': 'ge', 'ご': 'go',
            'ざ': 'za', 'じ': 'ji', 'ず': 'zu', 'ぜ': 'ze', 'ぞ': 'zo',
            'だ': 'da', 'ぢ': 'ji', 'づ': 'zu', 'で': 'de', 'ど': 'do',
            'ば': 'ba', 'び': 'bi', 'ぶ': 'bu', 'べ': 'be', 'ぼ': 'bo',
            'ぱ': 'pa', 'ぴ': 'pi', 'ぷ': 'pu', 'ぺ': 'pe', 'ぽ': 'po'
        };
        return hiraganaMap[char] || char;
    }

    function showWriting(char) {
        const modal = new bootstrap.Modal(document.getElementById('writingModal'));
        document.getElementById('charDisplay').textContent = char;
        const romaji = getRomaji(char);
        document.getElementById('writingImage').src = `/assets/images/hiragana/${romaji}.png`;
        const video = document.getElementById('writingVideo');
        video.querySelector('source').src = `/assets/videos/hiragana/${romaji}.webm`;
        video.load();
        video.playbackRate = 3.0; // Tăng tốc độ phát lên 2x
        modal.show();
    }
</script>

<style>
    .fade-in {
        opacity: 0;
        transform: translateY(24px);
        animation: fadeInUp 0.8s cubic-bezier(.4, 0, .2, 1) forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: none;
        }
    }

    .card {
        transition: box-shadow 0.2s, transform 0.2s;
    }

    .card:hover {
        box-shadow: 0 8px 32px 0 rgba(34, 34, 34, 0.12);
        transform: translateY(-4px) scale(1.02);
    }

    .btn-writing {
        font-size: 0.95rem;
        padding: 2px 14px;
        border-radius: 6px;
        border: 2px solid #E60012;
        background: #fff;
        color: #E60012;
        font-weight: 500;
        transition: all 0.18s;
    }

    .btn-writing:hover,
    .btn-writing:focus {
        background: #E60012;
        color: #fff;
        border-color: #E60012;
    }
</style>